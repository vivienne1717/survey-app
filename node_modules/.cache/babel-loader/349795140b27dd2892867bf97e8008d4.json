{"ast":null,"code":"var _jsxFileName = \"/Users/wei/Desktop/Project/Recommendation/Pre-exp Survey/website/survey-app1-1/src/Pages/MovieList.jsx\";\nimport * as React from \"react\";\nimport \"./MovieList.css\";\nimport \"./Movie\";\nimport Movie from \"./Movie\";\nimport MovieFullList1 from '../Assets/MovieFullList1';\nimport Part1Modal from \"./Part1Modal.jsx\";\nimport { Pagination } from 'antd';\nimport Cookies from 'universal-cookie';\nimport { Row, Col } from 'antd';\nimport SurveyWithPoster from \"./SurveyWithPoster\";\nexport default class MovieList extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.childRef = React.createRef();\n    this.state = {\n      genre: \"Genre 1\",\n      listOfMovies: Array,\n      filteredMovies: Array,\n      displayMovies: Array,\n      currentPage: 1,\n      pageSize: 150,\n      selectedMovies: Array,\n      surveyMovies: [],\n      selectedMovie2: Array,\n      surveyComplete: false\n    };\n\n    this.filterMovieList = (movieList, genreList, yearFilter) => {\n      let result1 = [];\n      movieList.forEach(movie => {\n        var year = parseInt(movie.year);\n        var genres = movie.genres;\n        var genresInArr = genres.split(',');\n        let intersect = genresInArr.filter(value => -1 !== genreList.indexOf(value));\n        let yearStart = 1995;\n        let yearEnd = 2019;\n\n        if (yearFilter !== 'All Movies') {\n          yearStart = parseInt(yearFilter.split('-')[0]);\n          yearEnd = parseInt(yearFilter.split('-')[1]);\n        }\n\n        if (intersect.length > 0 && yearStart <= year && year <= yearEnd) result1.push(movie);\n      });\n      var ranchoose = [];\n      var result = [];\n\n      while (ranchoose.length < result1.length) {\n        var ranum = Math.floor(Math.random() * result1.length) + 0;\n\n        if (ranchoose.indexOf(ranum) == -1) {\n          ranchoose.push(ranum);\n          result.push(result1[ranum]);\n        }\n      }\n\n      return result;\n    };\n\n    this.createMovieList = (page, pageSize) => {\n      let list = []; //console.log(\"now rendering movie list \"+ JSON.stringify(this.state.listOfMovies))\n\n      const cookies = new Cookies();\n      let survey2 = cookies.get('survey2');\n      console.log('survey 2 now contains' + JSON.stringify(survey2));\n      this.state.filteredMovies.forEach(movie => {\n        if (!movie['rating'] && movie['rating'] !== 0.0) movie['rating'] = 0.0;\n\n        if (this.props.fromStep3) {\n          if (!this.checkSurvey2Contains(survey2, movie)) {\n            var movie_ = React.createElement(Col, {\n              span: 3,\n              style: {\n                width: 'auto',\n                height: 425,\n                padding: 0\n              },\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 130\n              },\n              __self: this\n            }, \" \", React.createElement(Movie, {\n              SingleMovie: movie,\n              onAddMovie: this.addMovieToSelection,\n              __source: {\n                fileName: _jsxFileName,\n                lineNumber: 130\n              },\n              __self: this\n            }));\n            list.push(movie_);\n          }\n        } else {\n          var movie_ = React.createElement(Col, {\n            span: 3,\n            style: {\n              width: 'auto',\n              height: 425,\n              padding: 0\n            },\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 134\n            },\n            __self: this\n          }, \" \", React.createElement(Movie, {\n            SingleMovie: movie,\n            onAddMovie: this.addMovieToSelection,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 134\n            },\n            __self: this\n          }));\n          list.push(movie_);\n        }\n      });\n      var starting = (page - 1) * pageSize;\n      var ending = starting + pageSize > this.state.filteredMovies.length ? this.state.filteredMovies.length : starting + pageSize;\n      return list.slice(starting, ending);\n    };\n\n    this.onShowSizeChange = (current, pageSize) => {\n      var list = this.createMovieList(1, pageSize);\n      this.setState({\n        currentPage: 1,\n        pageSize: pageSize,\n        displayMovies: list\n      });\n    };\n\n    this.onPageChange = (page, pageSize) => {\n      var list = this.createMovieList(page, pageSize);\n      this.setState({\n        currentPage: page,\n        displayMovies: list\n      });\n    };\n\n    this.addMovieToSelection = movie => {\n      var fromStep3 = this.props.fromStep3;\n      console.log(\"from Step 3 \" + fromStep3);\n      const cookies = new Cookies();\n\n      if (fromStep3) {\n        var selectedMovies = this.state.selectedMovies;\n\n        if (selectedMovies.length >= 0 && selectedMovies.length < 20) {\n          if (selectedMovies.indexOf(movie) === -1) selectedMovies.push(movie);else {\n            if (movie['rating'] <= 0) {\n              var index = selectedMovies.indexOf(movie);\n              selectedMovies.splice(index, 1);\n            }\n          }\n        }\n\n        if (selectedMovies.length === 3) {\n          selectedMovies.forEach(movie => {\n            movie.ans = [8, 8, 8, 8]; // initialze ans for survery qns\n          });\n          this.childRef.current.toggleVisible();\n        }\n\n        this.setState({\n          surveyMovies: selectedMovies\n        });\n      } else {\n        var selectedMovies = this.state.selectedMovies;\n\n        if (selectedMovies.length >= 0 && selectedMovies.length < 20) {\n          if (selectedMovies.indexOf(movie) === -1) selectedMovies.push(movie);else {\n            if (movie['rating'] <= 0) {\n              var index = selectedMovies.indexOf(movie);\n              selectedMovies.splice(index, 1);\n            }\n          }\n        } //set the number of movies required selection \n\n\n        if (selectedMovies.length === 15) {\n          //change above to 20, in production\n          cookies.set('survey2a', this.reduceCookieSize(selectedMovies), {\n            path: '/'\n          });\n          console.log(\"survey 2a \" + JSON.stringify(selectedMovies));\n          selectedMovies = this.selectRandomMovies(selectedMovies, 5, 15); //change no. as well if change no. of selected movies\n\n          selectedMovies.forEach(movie => {\n            movie.ans = [8, 8, 8, 8]; // initialze ans for survery qns\n          });\n          this.childRef.current.toggleVisible();\n        }\n\n        this.setState({\n          surveyMovies: selectedMovies\n        });\n      }\n    };\n\n    this.checkSurveyComplete = value => {\n      this.setState({\n        surveyComplete: true\n      });\n    };\n  }\n\n  componentWillMount() {\n    var genreFilters = this.props.genreFilters;\n    var yearFilter = this.props.yearFilter;\n    let filteredMovies = [];\n    if (genreFilters.length > 0) filteredMovies = this.filterMovieList(MovieFullList1, genreFilters, yearFilter);\n    this.setState({\n      listOfMovies: MovieFullList1,\n      displayMovies: [],\n      filteredMovies: filteredMovies,\n      selectedMovies: [],\n      selectedMovies2: []\n    });\n  }\n\n  componentDidMount() {\n    let list = this.createMovieList(this.state.currentPage, this.state.pageSize);\n    this.setState({\n      displayMovies: list\n    });\n  }\n\n  componentWillReceiveProps(nextProps) {\n    var genreFilters = nextProps.genreFilters;\n    var yearFilter = nextProps.yearFilter;\n    let filteredMovies = [];\n    if (genreFilters.length > 0) filteredMovies = this.filterMovieList(MovieFullList1, genreFilters, yearFilter);\n    this.setState({\n      filteredMovies: filteredMovies\n    }, () => {\n      //update display list \n      let displayList = this.createMovieList(1, this.state.pageSize);\n      this.setState({\n        displayMovies: displayList,\n        currentPage: 1\n      });\n    });\n  } // filterMovieList = (movieList, genreList, yearFilter) => {\n  //   let result = []\n  //   movieList.forEach(movie => {\n  //     var year = parseInt(movie.year)\n  //     var genres = movie.genres\n  //     var genresInArr = genres.split(',').map(item=>item.trim())\n  //     let intersect = genresInArr.filter(value => -1 !== genreList.indexOf(value))\n  //     let yearStart = parseInt(yearFilter.split('-')[0])\n  //     let yearEnd = parseInt(yearFilter.split('-')[1])\n  //     if (intersect.length > 0 && yearStart <= year && year <= yearEnd)\n  //       result.push(movie)\n  //   });\n  //   return result;\n  // }\n\n\n  checkSurvey2Contains(survey2, movie) {\n    var result = false;\n\n    for (var i = 0; i < survey2.length; i++) {\n      var movieId = survey2[i].movieId;\n      var _movieId = movie.movieId;\n      if (movieId === _movieId) result = true;\n    }\n\n    return result;\n  }\n\n  selectRandomMovies(movies, wantNumber, maxNumber) {\n    var numberList = [];\n    var movieList = [];\n\n    while (numberList.length < wantNumber) {\n      var num = Math.floor(Math.random() * (maxNumber - 1 - 0 + 1)) + 0;\n\n      if (numberList.indexOf(num) == -1) {\n        numberList.push(num);\n        movieList.push(movies[num]);\n      }\n    }\n\n    return movieList;\n  }\n\n  reduceCookieSize(selectedMovies) {\n    let slimCookie = [];\n\n    for (var i = 0; i < selectedMovies.length; i++) {\n      var movie = {};\n      movie.title = selectedMovies[i].title;\n      movie.movieId = selectedMovies[i].movieId;\n      movie.rating = selectedMovies[i].rating;\n      movie.ans = selectedMovies[i].ans;\n      slimCookie.push(movie);\n    }\n\n    return slimCookie;\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 265\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"movie-counter\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266\n      },\n      __self: this\n    }, \"You have selected \", this.state.selectedMovies.length, \"/\", this.props.fromStep3 ? 3 : 15, \" movies\"), React.createElement(\"div\", {\n      className: \"list-panel\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 269\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"display-movie\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 271\n      },\n      __self: this\n    }, React.createElement(Row, {\n      gutter: [24, 20],\n      justify: \"space-between\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 272\n      },\n      __self: this\n    }, this.state.displayMovies)), React.createElement(Pagination, {\n      showSizeChanger: true,\n      pageSizeOptions: ['50', '100', '150', '200'],\n      onShowSizeChange: this.onShowSizeChange,\n      current: this.state.currentPage,\n      defaultCurrent: 1,\n      pageSize: this.state.pageSize,\n      onChange: this.onPageChange,\n      total: this.state.filteredMovies.length,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 277\n      },\n      __self: this\n    }), React.createElement(Part1Modal, {\n      ref: this.childRef,\n      selectedMovies: this.state.surveyMovies,\n      onSurveyComplete: this.checkSurveyComplete,\n      fromStep3: this.props.fromStep3,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 287\n      },\n      __self: this\n    })));\n  }\n\n}","map":{"version":3,"sources":["/Users/wei/Desktop/Project/Recommendation/Pre-exp Survey/website/survey-app1-1/src/Pages/MovieList.jsx"],"names":["React","Movie","MovieFullList1","Part1Modal","Pagination","Cookies","Row","Col","SurveyWithPoster","MovieList","Component","childRef","createRef","state","genre","listOfMovies","Array","filteredMovies","displayMovies","currentPage","pageSize","selectedMovies","surveyMovies","selectedMovie2","surveyComplete","filterMovieList","movieList","genreList","yearFilter","result1","forEach","movie","year","parseInt","genres","genresInArr","split","intersect","filter","value","indexOf","yearStart","yearEnd","length","push","ranchoose","result","ranum","Math","floor","random","createMovieList","page","list","cookies","survey2","get","console","log","JSON","stringify","props","fromStep3","checkSurvey2Contains","movie_","width","height","padding","addMovieToSelection","starting","ending","slice","onShowSizeChange","current","setState","onPageChange","index","splice","ans","toggleVisible","set","reduceCookieSize","path","selectRandomMovies","checkSurveyComplete","componentWillMount","genreFilters","selectedMovies2","componentDidMount","componentWillReceiveProps","nextProps","displayList","i","movieId","_movieId","movies","wantNumber","maxNumber","numberList","num","slimCookie","title","rating","render"],"mappings":"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","sourcesContent":["import * as React from \"react\";\nimport \"./MovieList.css\";\nimport \"./Movie\";\nimport Movie from \"./Movie\";\nimport MovieFullList1 from '../Assets/MovieFullList1';\nimport Part1Modal from \"./Part1Modal.jsx\";\nimport { Pagination } from 'antd';\nimport Cookies from 'universal-cookie';\n\nimport { Row, Col } from 'antd';\nimport SurveyWithPoster from \"./SurveyWithPoster\";\n\nexport default class MovieList extends React.Component {\n  childRef: React.RefObject<Part1Modal> = React.createRef();\n\n  state = {\n    genre: \"Genre 1\",\n    listOfMovies: Array,\n    filteredMovies: Array,\n    displayMovies: Array,\n    currentPage: 1,\n    pageSize: 150,\n    selectedMovies: Array,\n    surveyMovies: [],\n    selectedMovie2: Array,\n    surveyComplete: false\n  }\n\n  componentWillMount() {\n    var genreFilters = this.props.genreFilters\n    var yearFilter = this.props.yearFilter\n\n    let filteredMovies = []\n    if (genreFilters.length > 0)\n      filteredMovies = this.filterMovieList(MovieFullList1, genreFilters, yearFilter)\n    this.setState({\n      listOfMovies: MovieFullList1,\n      displayMovies: [],\n      filteredMovies: filteredMovies,\n      selectedMovies: [],\n      selectedMovies2: []\n    })\n  }\n\n  componentDidMount() {\n    let list = this.createMovieList(this.state.currentPage, this.state.pageSize)\n    this.setState({\n      displayMovies: list\n    })\n  }\n\n  componentWillReceiveProps(nextProps) {\n    var genreFilters = nextProps.genreFilters\n    var yearFilter = nextProps.yearFilter\n    let filteredMovies = []\n    if (genreFilters.length > 0)\n      filteredMovies = this.filterMovieList(MovieFullList1, genreFilters, yearFilter)\n    this.setState({\n      filteredMovies: filteredMovies\n    }, () => {\n      //update display list \n      let displayList = this.createMovieList(1, this.state.pageSize)\n      this.setState({\n        displayMovies: displayList,\n        currentPage: 1\n      })\n    })\n  }\n\n  // filterMovieList = (movieList, genreList, yearFilter) => {\n  //   let result = []\n  //   movieList.forEach(movie => {\n  //     var year = parseInt(movie.year)\n  //     var genres = movie.genres\n  //     var genresInArr = genres.split(',').map(item=>item.trim())\n  //     let intersect = genresInArr.filter(value => -1 !== genreList.indexOf(value))\n  //     let yearStart = parseInt(yearFilter.split('-')[0])\n  //     let yearEnd = parseInt(yearFilter.split('-')[1])\n\n  //     if (intersect.length > 0 && yearStart <= year && year <= yearEnd)\n  //       result.push(movie)\n  //   });\n  //   return result;\n  // }\n\n  filterMovieList = (movieList, genreList, yearFilter) => {\n    let result1 = []\n    movieList.forEach(movie => {\n      var year = parseInt(movie.year)\n      var genres = movie.genres\n      var genresInArr = genres.split(',')\n      let intersect = genresInArr.filter(value => -1 !== genreList.indexOf(value))\n      let yearStart = 1995\n      let yearEnd = 2019\n\n      if(yearFilter !== 'All Movies') {\n        yearStart = parseInt(yearFilter.split('-')[0])\n        yearEnd = parseInt(yearFilter.split('-')[1])\n      }\n\n      if (intersect.length > 0 && yearStart <= year && year <= yearEnd)\n        result1.push(movie)\n    });\n    var ranchoose = []\n    var result = []\n    while (ranchoose.length < result1.length) {\n      var ranum = Math.floor(Math.random() * result1.length) + 0;\n      if (ranchoose.indexOf(ranum) == -1) {\n        ranchoose.push(ranum)\n        result.push(result1[ranum])\n      }\n    }\n    return result;\n  }\n\n\n\n\n  createMovieList = (page, pageSize) => {\n    let list = [];\n    //console.log(\"now rendering movie list \"+ JSON.stringify(this.state.listOfMovies))\n    const cookies = new Cookies();\n    let survey2 = cookies.get('survey2')\n    console.log('survey 2 now contains' + JSON.stringify(survey2))\n    this.state.filteredMovies.forEach(movie => {\n      if (!movie['rating'] && movie['rating'] !== 0.0)\n        movie['rating'] = 0.0\n      if (this.props.fromStep3) {\n        if (!this.checkSurvey2Contains(survey2, movie)) {\n          var movie_ = <Col span={3} style={{ width: 'auto', height: 425, padding:0 }}> <Movie SingleMovie={movie} onAddMovie={this.addMovieToSelection} /></Col>\n          list.push(movie_)\n        }\n      } else {\n        var movie_ = <Col span={3} style={{ width: 'auto', height: 425, padding:0}}> <Movie SingleMovie={movie} onAddMovie={this.addMovieToSelection} /></Col>\n        list.push(movie_)\n      }\n    })\n\n    var starting = (page - 1) * pageSize;\n    var ending = (starting + pageSize) > this.state.filteredMovies.length ? this.state.filteredMovies.length : starting + pageSize\n\n    return list.slice(starting, ending);\n  }\n\n  onShowSizeChange = (current, pageSize) => {\n    var list = this.createMovieList(1, pageSize)\n    this.setState({\n      currentPage: 1,\n      pageSize: pageSize,\n      displayMovies: list\n    })\n  }\n\n  checkSurvey2Contains(survey2, movie) {\n    var result = false;\n    for (var i = 0; i < survey2.length; i++) {\n      var movieId = survey2[i].movieId\n      var _movieId = movie.movieId\n      if (movieId === _movieId)\n        result = true\n    }\n    return result;\n  }\n  onPageChange = (page, pageSize) => {\n    var list = this.createMovieList(page, pageSize)\n\n    this.setState({\n      currentPage: page,\n      displayMovies: list\n    })\n  }\n\n  addMovieToSelection = (movie) => {\n    var fromStep3 = this.props.fromStep3\n    console.log(\"from Step 3 \" + fromStep3)\n    const cookies = new Cookies();\n\n    if (fromStep3) {\n      var selectedMovies = this.state.selectedMovies\n      if (selectedMovies.length >= 0 && selectedMovies.length < 20) {\n        if (selectedMovies.indexOf(movie) === -1)\n          selectedMovies.push(movie)\n        else {\n          if (movie['rating'] <= 0) {\n            var index = selectedMovies.indexOf(movie)\n            selectedMovies.splice(index, 1)\n          }\n        }\n      }\n      if (selectedMovies.length === 3) {\n        selectedMovies.forEach(movie => {\n          movie.ans = [8, 8, 8, 8] // initialze ans for survery qns\n        });\n        this.childRef.current.toggleVisible()\n      }\n      this.setState({\n        surveyMovies: selectedMovies\n      })\n    } else {\n      var selectedMovies = this.state.selectedMovies\n      if (selectedMovies.length >= 0 && selectedMovies.length < 20) {\n        if (selectedMovies.indexOf(movie) === -1)\n          selectedMovies.push(movie)\n        else {\n          if (movie['rating'] <= 0) {\n            var index = selectedMovies.indexOf(movie)\n            selectedMovies.splice(index, 1)\n          }\n        }\n      }\n      //set the number of movies required selection \n      if (selectedMovies.length === 15) {\n        //change above to 20, in production\n        cookies.set('survey2a', this.reduceCookieSize(selectedMovies), { path: '/' });\n        console.log(\"survey 2a \" + JSON.stringify(selectedMovies))\n        selectedMovies = this.selectRandomMovies(selectedMovies, 5, 15) //change no. as well if change no. of selected movies\n        selectedMovies.forEach(movie => {\n          movie.ans = [8, 8, 8, 8] // initialze ans for survery qns\n        });\n        this.childRef.current.toggleVisible()\n      }\n      this.setState({\n        surveyMovies: selectedMovies\n      })\n    }\n  }\n\n  selectRandomMovies(movies, wantNumber, maxNumber) {\n    var numberList = []\n    var movieList = []\n    while (numberList.length < wantNumber) {\n      var num = Math.floor(Math.random() * ((maxNumber - 1) - 0 + 1)) + 0;\n      if (numberList.indexOf(num) == -1) {\n        numberList.push(num)\n        movieList.push(movies[num])\n      }\n    }\n    return movieList\n  }\n\n  checkSurveyComplete = (value) => {\n\n    this.setState({\n      surveyComplete: true\n    })\n  }\n\n  reduceCookieSize(selectedMovies){\n    let slimCookie = [] \n    for(var i=0;i<selectedMovies.length;i++){\n      var movie = {}\n      movie.title = selectedMovies[i].title\n      movie.movieId = selectedMovies[i].movieId\n      movie.rating = selectedMovies[i].rating\n      movie.ans = selectedMovies[i].ans\n      slimCookie.push(movie)\n    }\n\n    return slimCookie;\n  }\n\n  render() {\n\n    return (\n      <div>\n        <div className=\"movie-counter\">\n          You have selected {this.state.selectedMovies.length}/{this.props.fromStep3 ? 3 : 15} movies\n          </div>\n        <div className=\"list-panel\">\n\n          <div className=\"display-movie\">\n            <Row gutter={[24, 20]} justify=\"space-between\" >\n              {this.state.displayMovies}\n            </Row>\n          </div>\n\n          <Pagination\n            showSizeChanger\n            pageSizeOptions={['50', '100', '150', '200']}\n            onShowSizeChange={this.onShowSizeChange}\n            current={this.state.currentPage}\n            defaultCurrent={1}\n            pageSize={this.state.pageSize}\n            onChange={this.onPageChange}\n            total={this.state.filteredMovies.length}\n          />\n          <Part1Modal ref={this.childRef} selectedMovies={this.state.surveyMovies} onSurveyComplete={this.checkSurveyComplete} fromStep3={this.props.fromStep3}></Part1Modal>\n        </div>\n      </div>\n\n    );\n  }\n\n}"]},"metadata":{},"sourceType":"module"}